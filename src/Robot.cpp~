// RobotBuilder Version: 1.5
//
// This file was generated by RobotBuilder. It contains sections of
// code that are automatically generated and assigned by robotbuilder.
// These sections will be updated in the future when you export to
// C++ from RobotBuilder. Do not put any code or make any change in
// the blocks indicating autogenerated code or it will be lost on an
// update. Deleting the comments indicating the section will prevent
// it from being updated in the future.
#include "Commands/GrabContainerAndBackup.h"
#include "Commands/AutoToteContainerStack.h"
#include "Commands/MoveForwardAndTurn.h"
#include "Commands/DoNothingAuto.h"

#include "Robot.h"
//#include "arm/include/OpenCV/opencv2/opencv.hpp"
// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=INITIALIZATION
Chassis* Robot::chassis = 0;
LedStrip* Robot::ledStrip = 0;
Grabber* Robot::grabber = 0;
Lifter* Robot::lifter = 0;
OI* Robot::oi = 0;

    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=INITIALIZATION

Recorder* Robot::rec = NULL;
Macro* Robot::mac1 = NULL;
Macro* Robot::mac2 = NULL;

void Robot::RobotInit() {
	RobotMap::init();

	rec = Recorder::GetInstance();

	rec->AddDevice("Left Front",RobotMap::chassisLeftFrontCtrl);
	rec->AddDevice("Left Rear",RobotMap::chassisLeftRearCtrl);
	rec->AddDevice("Right Front",RobotMap::chassisRightFrontCtrl);
	rec->AddDevice("Right Rear", RobotMap::chassisRightRearCtrl);

	rec->AddDevice("Winch", RobotMap::lifterWinch);

	rec->AddDevice("Grabber",RobotMap::grabberGrabberSolenoid);

	mac1 = rec->macro();
	mac2 = rec->macro();

	// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=CONSTRUCTORS
	chassis = new Chassis();
	ledStrip = new LedStrip();
	grabber = new Grabber();
	lifter = new Lifter();

    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=CONSTRUCTORS

	oi = new OI();
	lw = LiveWindow::GetInstance();

	// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=AUTONOMOUS

    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=AUTONOMOUS

	CameraServer::GetInstance()->StartAutomaticCapture("cam0");

	autonomousCommand = new GrabContainerAndBackup();

	//Autonomous choosing
	autoChooser = new SendableChooser();
	autoChooser->AddDefault("Container or Tote", new GrabContainerAndBackup() );
	autoChooser->AddObject("Move Forward",new MoveForwardAndTurn()) ;
	autoChooser->AddObject("Stack", new AutoToteContainerStack());
	autoChooser->AddObject("Do Nothing (lame)", new DoNothingAuto());
	SmartDashboard::PutData("Auto Program", autoChooser);

	SmartDashboard::PutBoolean("Bottom hit", false);
	SmartDashboard::PutBoolean("Hall effect sensor",false);
	SmartDashboard::PutBoolean("Stop at bottom",true);

}

/**
 * This function is called when the disabled button is hit.
 * You can use it to reset subsystems before shutting down.
 */
void Robot::DisabledInit () {
	Scheduler::GetInstance()->RemoveAll();
	grabber->Stop();
	chassis->Stop();
	lifter->Stop();

	ledStrip->Set(0,1,1,0);
}
void Robot::DisabledPeriodic() {

}


void Robot::AutonomousInit() {
	lifter->SetLightOff();
	ledStrip->Set(0,0,0,0);
	autonomousCommand = (Command*) autoChooser->GetSelected();
	//autonomousCommand  = new AutoToteContainerStack();
	autonomousCommand->Start();
}
void Robot::AutonomousPeriodic() {
	Scheduler::GetInstance()->Run();
}
void Robot::TeleopInit() {
	lifter->SetLightOff();
	ledStrip->Set(0,0,1,0);
	if ( autonomousCommand->IsRunning() ) autonomousCommand->Cancel();

	grabber->airCompressor->Start();
	oi->driveWithJoysticks->Start();
	oi->lifterWithJoystick->Start();
}

void Robot::TeleopPeriodic() {
	Scheduler::GetInstance()->Run();

	if (oi->getStickRight()->GetRawButton(9)) lifter->stopAtBottom = false;
	else if (oi->getStickRight()->GetRawButton(8)) lifter->stopAtBottom = true;

	SmartDashboard::PutBoolean("Bottom hit", lifter->BottomHit());
	SmartDashboard::PutBoolean("Hall effect sensor",lifter->MagnetHit());
	SmartDashboard::PutBoolean("Stop at bottom",lifter->stopAtBottom);

	//SmartDashboard::PutBoolean("Pressure switch", grabber->airCompressor->GetPressureSwitchValue());
}
void Robot::TestInit() {

}
void Robot::TestPeriodic() {
	lw->Run();
}
START_ROBOT_CLASS(Robot);

